1. Single-stage Dockerfile:

---

FROM node:24-alpine
WORKDIR /app
COPY package\*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]

2. Multi-stage Dockerfile:

---

# Stage 1: Builder

FROM node:24 AS builder
WORKDIR /app
COPY package\*.json ./
RUN npm install
COPY . .
RUN npm run build

# Stage 2: Production

FROM node:24-alpine AS production
WORKDIR /app
COPY package\*.json ./
RUN npm install --omit=dev
COPY --from=builder /app/dist ./dist
EXPOSE 3000
CMD ["node", "dist/index.js"]

3. .dockerignore content:

---

node_modules
\*.ts
.git
Dockerfile.single
dist
npm-debug.log

4. Commands used:

---

docker build -f Dockerfile.single -t node-single:v1 .
docker build -t node-multistage:v1 .
docker build -t node-multistage:v2 .
docker images
docker run -d -p 3000:3000 node-multistage:v2
curl http://localhost:3000

5. Image size comparison:

REPOSITORY TAG IMAGE ID CREATED SIZE
node-multistage v2 5aa68c5b39e0 7 minutes ago 292MB
node-multistage v1 47b903cd5c56 7 minutes ago 292MB
node-single v1 77ddc47701f6 14 minutes ago 332MB


Note: Multi-stage build produces smaller and cleaner image by excluding dev dependencies and source files

6. Test result:

Response from app:
"Hello from Docker Multi-Stage Build!"

